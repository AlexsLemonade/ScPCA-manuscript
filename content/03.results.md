# Results

## The Single-cell Pediatric Cancer Atlas Portal

1. History of the Portal
  - In 2019, Alex's Lemonade Stand Foundation funded 10 investigators working on single-cell profiling to create a publicly available atlas of single-cell pediatric cancer data.
  ** are there more specific information about how things were funded that I should include?**
  - These 10 investigators produced single-cell and single-nuclei RNA-seq data across a variety of tumors
  - The raw data and associated metadata was sent to the Childhood Cancer Data Lab for uniform processing
  - We created an open-source efficient pipeline to process all samples present on the Portal
  - In 2022, the Childhood Cancer Data Lab launched the Single-cell Pediatric Cancer Atlas (ScPCA) Portal to make uniformly processed, summarized single-cell and single-nuclei RNA-seq data and de-identified metadata available for download.
  - In 2023, we began to expand the Portal to other investigators, putting out a call for contributions.
  - For these projects, investigators used our open-source pipeline to produce summarized gene expression data for inclusion on the portal.

2. Overview of data available on the Portal
  - The Portal currently holds X amount of samples from X amount of tumor types.
  - For all samples we collect a core set of metadata including, age, sex, diagnosis, subdiagnosis (if applicable), tissue location, and disease stage.
  - Fig. 1A shows how many samples we have from each type of tumor. For each diagnosis, we also indicate what proportion of the samples come from each disease stage (e.g., initial diagnosis, recurrence, post-mortem).
  - In addition to single-cell and single-nuclei RNA-seq, many samples have associated bulk RNA-seq, ADT data (CITE-seq), cell hashing, or spatial transcriptomics.
  - Fig. 2B summarizes the total number of samples that are single-cell vs. single-nuclei. Additionally, we show how many of the samples on the portal also have either bulk, CITE, cell hashing, or spatial data.
  - Supplemental Table 1 shows a breakdown of how many of each modality is found in each project.
  ** By submission we will provably have PDX/ cell line information on the portal so we might want to mention that here and add to figures?**

3. Obtaining additional project information
  - On the Portal, samples are organized by project. Each project is a collection of similar samples from a single investigator.
  - To select projects of interest, users can filter based on diagnosis, modality included, single-cell or single-nuclei and 10X version. Additionally, users will be able to filter based on if the project includes cell line samples or xenografts.
  - A summary of each project, including a list of samples found in each project, is displayed on the Portal.
  - Fig.1C shows an example of this summary which include an abstract, links to any external information about the projects such as any associated publication information, and links to external places where data may be stored such as SRA or GEO.
  - If a project includes bulk, CITE, spatial, or multiplexing, this will also be indicated on the project card.


## Uniform processing of data available on the ScPCA Portal

1. Processing data with scpca-nf and alevin-fry
  - All data available on the portal was uniformly processed using scpca-nf, an open-source and efficient Nextflow workflow for quantifying single-cell and single-nuclei RNA-seq data.
  - The workflow uses `salmon alevin` and `alevin-fry` to quantify gene expression data and outputs both raw and normalized counts stored as `SingleCellExperiment` and `AnnData` objects.
   - In building the workflow we sought to look for a tool that was fast and memory efficient with comparable results to other popular tools, like `Cell Ranger`.
   - Reads are aligned using the selective alignment option of `salmon alevin` to an index with transcripts corresponding to spliced cDNA and intronic regions, denoted by `alevin-fry` as a `splici` index.
   - We compared quantification of 3 single-cell and 3 single-nuclei samples with `alevin-fry` and `Cell Ranger` and observed a decrease in both run time and memory usage in `alevin-fry` compared to `Cell Ranger` (FigS1A).
   - When comparing the total UMIs per cell, total genes detected per cell, and mean gene expression, there was no observable difference between `alevin-fry` and `Cell Ranger` (FigS1B-D).
   - By utilizing `alevin-fry` in the `scpca-nf` workflow we can process multiple samples at a fraction of the time and cost.

2. Post-processing of quantified gene expression data (Fig 2A)
  - In addition to quantification of gene expression, `scpca-nf` also performs filtering, normalization, dimensionality reduction, and cell type annotation.
  - The output from  `alevin-fry` includes a gene by cell count matrix for all barcodes identified, even those that may not contain true cells. This matrix is stored in a `SingleCellExperiment` and output from the workflow as an `_unfiltered.rds` file.
  - The unfiltered gene by cell counts matrices are then filtered using `DropletUtils::emptyDropsCellRanger()` to remove any barcodes that are not likely to contain cells. All cells that pass this filtering are saved to a filtered `SingleCellExperiment` object and `_filtered.rds` file.
  - This filtered object is used as input to the post-processing part of the workflow. This includes removal of low-qaulity cells using `miQC`, normalization, and dimensionality reduction. The final step of the post-processing performed in `scpca-nf` is classification of cell types using automated methods, `SingleR` and `CellAssign`. The results from this analysis are stored in a processed object saved to a `processed.rds`.
  - Finally, all `SingleCellExperiment` objects saved as `.rds` files are converted to `AnnData` objects and saved as `.hdf5` files to allow for downstream processing in either R or Python.
  - On the Portal, users can choose to download data as either `SingleCellExperiment` or `AnnData` objects and all downloads will contain all three objects output from `scpca-nf`, the unfiltered, filtered, and processed objects.

3. QC report (Fig 2B)
  - Along with outputting the uniformly processed data files, `scpca-nf` also includes a step to create a quality control report for each library.
  - This report includes a summary of processing information and library statistics, e.g., the total number of mapped reads, total number of cells, and relevant versions of tools used within the workflow like `salmon` and `alevin-fry`.
  - Each report also includes summarized plots showing the quality of each library.
  - The knee plot shown in the report ranks the total number of UMIs in each droplet and indicates cells that remained after filtering out empty droplets.
  - For each cell that passes filtering out empty droplets, the number of total UMIs, genes detected, and mitochondrial reads is calculated. These cell metrics are summarized in a single plot.
  - To remove low-quality cells from the counts matrices, `scpca-nf` applies `miQC`, a data driven approach to filtering cells. The `miQC` model and a plot showing which cells are kept and removed when filtering with `miQC` are shown in the QC report.
  - Finally, remaining cells are normalized and undergo dimensionality reduction. The QC report includes a single UMAP where cells are colored by the total number of genes detected and a faceted UMAP where cells are colored by the expression of a top highly variable gene.

4. Benefits of scpca-nf/ Nextflow allows for reproducibility and portability
  - Using Nextflow as the backbone for the `scpca-nf` workflow ensures reproducibility and portability for users on other systems.
  - Nextflow handles all dependencies automatically and set up generally requires only organizing input files and configuring Nextflow for your environment.
  - Each process in the workflow is run in a docker container, so users only need to install Nextflow and docker to be able to use this workflow.
  - Nextflow also handles parallelizing processing based on your environment and will configure processing so that run time is minimal.
  - In addition to the data that we processed through `scpca-nf`, there are a handful of projects on the Portal that we did not process, as external users were able to implement and run `scpca-nf` on their own raw data prior to submission.
  - Because of the portability of `scpca-nf`, members of the pediatric research community with single-cell and single-nuclei data are able to run the workflow in the environment of their choice and process samples in the same uniform way that samples on the Portal have been processed.
  - This allows us to easily grow the Portal and accept contributions from the community and allows users to process their own data in a quick-efficient manner for easy comparison to samples on the Portal.
